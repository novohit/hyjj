<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hyjj.hyjjservice.dao.ReportDataMapper">
    <resultMap id="BaseResultMap" type="com.hyjj.hyjjservice.dataobject.ReportData">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sat Jan 09 22:49:25 CST 2021.
        -->
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="fill_person" jdbcType="VARCHAR" property="fillPerson"/>
        <result column="fill_unit" jdbcType="VARCHAR" property="fillUnit"/>
        <result column="add_date" jdbcType="TIMESTAMP" property="addDate"/>
        <result column="area_name" jdbcType="VARCHAR" property="areaName"/>
        <result column="report_template_id" jdbcType="BIGINT" property="reportTemplateId"/>
        <result column="area_code" jdbcType="VARCHAR" property="areaCode"/>
        <result column="begin_date" jdbcType="TIMESTAMP" property="beginDate"/>
        <result column="end_date" jdbcType="TIMESTAMP" property="endDate"/>
        <result column="submit_date" jdbcType="TIMESTAMP" property="submitDate"/>
        <result column="pro_status" jdbcType="VARCHAR" property="proStatus"/>
        <result column="pro_status_name" jdbcType="VARCHAR" property="proStatusName"/>
        <result column="process_id" jdbcType="BIGINT" property="processId"/>
        <result column="statistics_principal" jdbcType="VARCHAR" property="statisticsPrincipal"/>
        <result column="unit_principal" jdbcType="VARCHAR" property="unitPrincipal"/>
        <result column="head_html" jdbcType="VARCHAR" property="headHtml"/>
        <result column="body_html" jdbcType="VARCHAR" property="bodyHtml"/>
        <result column="tail_html" jdbcType="VARCHAR" property="tailHtml"/>
        <result column="org_code" jdbcType="VARCHAR" property="orgCode"/>
        <result column="expire_date" jdbcType="TIMESTAMP" property="expireDate"/>
        <result column="audit_id" jdbcType="VARCHAR" property="auditId"/>
        <result column="enterprise_name" jdbcType="VARCHAR" property="enterpriseName"/>
        <result column="data_from" jdbcType="VARCHAR" property="dataFrom"/>
        <result column="enterprise" jdbcType="VARCHAR" property="enterprise"/>
        <result column="gmt_create" jdbcType="TIMESTAMP" property="gmtCreate"/>
        <result column="gmt_modified" jdbcType="TIMESTAMP" property="gmtModified"/>
        <result column="report_date" jdbcType="TIMESTAMP" property="reportDate"/>
        <result column="fill_date" jdbcType="TIMESTAMP" property="fillDate"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sat Jan 09 22:49:25 CST 2021.
        -->
        id, fill_person, fill_unit, add_date, area_name, report_template_id, area_code, begin_date,
        end_date, submit_date, pro_status, pro_status_name, process_id, statistics_principal,
        unit_principal, head_html, body_html, tail_html, org_code, expire_date, audit_id,
        enterprise_name, data_from, enterprise, gmt_create, gmt_modified, report_date, fill_date
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sat Jan 09 22:49:25 CST 2021.
        -->
        select
        <include refid="Base_Column_List"/>
        from report_data
        where id = #{id,jdbcType=BIGINT}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sat Jan 09 22:49:25 CST 2021.
        -->
        delete from report_data
        where id = #{id,jdbcType=BIGINT}
    </delete>
    <insert id="insert" parameterType="com.hyjj.hyjjservice.dataobject.ReportData">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sat Jan 09 22:49:25 CST 2021.
        -->
        insert into report_data (id, fill_person, fill_unit,
        add_date, area_name, report_template_id,
        area_code, begin_date, end_date,
        submit_date, pro_status, pro_status_name,
        process_id, statistics_principal, unit_principal,
        head_html, body_html, tail_html,
        org_code, expire_date, audit_id,
        enterprise_name, data_from, enterprise,
        gmt_create, gmt_modified, report_date,
        fill_date)
        values (#{id,jdbcType=BIGINT}, #{fillPerson,jdbcType=VARCHAR}, #{fillUnit,jdbcType=VARCHAR},
        #{addDate,jdbcType=TIMESTAMP}, #{areaName,jdbcType=VARCHAR}, #{reportTemplateId,jdbcType=BIGINT},
        #{areaCode,jdbcType=VARCHAR}, #{beginDate,jdbcType=TIMESTAMP}, #{endDate,jdbcType=TIMESTAMP},
        #{submitDate,jdbcType=TIMESTAMP}, #{proStatus,jdbcType=VARCHAR}, #{proStatusName,jdbcType=VARCHAR},
        #{processId,jdbcType=BIGINT}, #{statisticsPrincipal,jdbcType=VARCHAR}, #{unitPrincipal,jdbcType=VARCHAR},
        #{headHtml,jdbcType=VARCHAR}, #{bodyHtml,jdbcType=VARCHAR}, #{tailHtml,jdbcType=VARCHAR},
        #{orgCode,jdbcType=VARCHAR}, #{expireDate,jdbcType=TIMESTAMP}, #{auditId,jdbcType=VARCHAR},
        #{enterpriseName,jdbcType=VARCHAR}, #{dataFrom,jdbcType=VARCHAR}, #{enterprise,jdbcType=VARCHAR},
        #{gmtCreate,jdbcType=TIMESTAMP}, #{gmtModified,jdbcType=TIMESTAMP}, #{reportDate,jdbcType=TIMESTAMP},
        #{fillDate,jdbcType=TIMESTAMP})
    </insert>
    <insert id="insertSelective" parameterType="com.hyjj.hyjjservice.dataobject.ReportData">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sat Jan 09 22:49:25 CST 2021.
        -->
        insert into report_data
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="fillPerson != null">
                fill_person,
            </if>
            <if test="fillUnit != null">
                fill_unit,
            </if>
            <if test="addDate != null">
                add_date,
            </if>
            <if test="areaName != null">
                area_name,
            </if>
            <if test="reportTemplateId != null">
                report_template_id,
            </if>
            <if test="areaCode != null">
                area_code,
            </if>
            <if test="beginDate != null">
                begin_date,
            </if>
            <if test="endDate != null">
                end_date,
            </if>
            <if test="submitDate != null">
                submit_date,
            </if>
            <if test="proStatus != null">
                pro_status,
            </if>
            <if test="proStatusName != null">
                pro_status_name,
            </if>
            <if test="processId != null">
                process_id,
            </if>
            <if test="statisticsPrincipal != null">
                statistics_principal,
            </if>
            <if test="unitPrincipal != null">
                unit_principal,
            </if>
            <if test="headHtml != null">
                head_html,
            </if>
            <if test="bodyHtml != null">
                body_html,
            </if>
            <if test="tailHtml != null">
                tail_html,
            </if>
            <if test="orgCode != null">
                org_code,
            </if>
            <if test="expireDate != null">
                expire_date,
            </if>
            <if test="auditId != null">
                audit_id,
            </if>
            <if test="enterpriseName != null">
                enterprise_name,
            </if>
            <if test="dataFrom != null">
                data_from,
            </if>
            <if test="enterprise != null">
                enterprise,
            </if>
            <if test="gmtCreate != null">
                gmt_create,
            </if>
            <if test="gmtModified != null">
                gmt_modified,
            </if>
            <if test="reportDate != null">
                report_date,
            </if>
            <if test="fillDate != null">
                fill_date,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=BIGINT},
            </if>
            <if test="fillPerson != null">
                #{fillPerson,jdbcType=VARCHAR},
            </if>
            <if test="fillUnit != null">
                #{fillUnit,jdbcType=VARCHAR},
            </if>
            <if test="addDate != null">
                #{addDate,jdbcType=TIMESTAMP},
            </if>
            <if test="areaName != null">
                #{areaName,jdbcType=VARCHAR},
            </if>
            <if test="reportTemplateId != null">
                #{reportTemplateId,jdbcType=BIGINT},
            </if>
            <if test="areaCode != null">
                #{areaCode,jdbcType=VARCHAR},
            </if>
            <if test="beginDate != null">
                #{beginDate,jdbcType=TIMESTAMP},
            </if>
            <if test="endDate != null">
                #{endDate,jdbcType=TIMESTAMP},
            </if>
            <if test="submitDate != null">
                #{submitDate,jdbcType=TIMESTAMP},
            </if>
            <if test="proStatus != null">
                #{proStatus,jdbcType=VARCHAR},
            </if>
            <if test="proStatusName != null">
                #{proStatusName,jdbcType=VARCHAR},
            </if>
            <if test="processId != null">
                #{processId,jdbcType=BIGINT},
            </if>
            <if test="statisticsPrincipal != null">
                #{statisticsPrincipal,jdbcType=VARCHAR},
            </if>
            <if test="unitPrincipal != null">
                #{unitPrincipal,jdbcType=VARCHAR},
            </if>
            <if test="headHtml != null">
                #{headHtml,jdbcType=VARCHAR},
            </if>
            <if test="bodyHtml != null">
                #{bodyHtml,jdbcType=VARCHAR},
            </if>
            <if test="tailHtml != null">
                #{tailHtml,jdbcType=VARCHAR},
            </if>
            <if test="orgCode != null">
                #{orgCode,jdbcType=VARCHAR},
            </if>
            <if test="expireDate != null">
                #{expireDate,jdbcType=TIMESTAMP},
            </if>
            <if test="auditId != null">
                #{auditId,jdbcType=VARCHAR},
            </if>
            <if test="enterpriseName != null">
                #{enterpriseName,jdbcType=VARCHAR},
            </if>
            <if test="dataFrom != null">
                #{dataFrom,jdbcType=VARCHAR},
            </if>
            <if test="enterprise != null">
                #{enterprise,jdbcType=VARCHAR},
            </if>
            <if test="gmtCreate != null">
                #{gmtCreate,jdbcType=TIMESTAMP},
            </if>
            <if test="gmtModified != null">
                #{gmtModified,jdbcType=TIMESTAMP},
            </if>
            <if test="reportDate != null">
                #{reportDate,jdbcType=TIMESTAMP},
            </if>
            <if test="fillDate != null">
                #{fillDate,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.hyjj.hyjjservice.dataobject.ReportData">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sat Jan 09 22:49:25 CST 2021.
        -->
        update report_data
        <set>
            <if test="fillPerson != null">
                fill_person = #{fillPerson,jdbcType=VARCHAR},
            </if>
            <if test="fillUnit != null">
                fill_unit = #{fillUnit,jdbcType=VARCHAR},
            </if>
            <if test="addDate != null">
                add_date = #{addDate,jdbcType=TIMESTAMP},
            </if>
            <if test="areaName != null">
                area_name = #{areaName,jdbcType=VARCHAR},
            </if>
            <if test="reportTemplateId != null">
                report_template_id = #{reportTemplateId,jdbcType=BIGINT},
            </if>
            <if test="areaCode != null">
                area_code = #{areaCode,jdbcType=VARCHAR},
            </if>
            <if test="beginDate != null">
                begin_date = #{beginDate,jdbcType=TIMESTAMP},
            </if>
            <if test="endDate != null">
                end_date = #{endDate,jdbcType=TIMESTAMP},
            </if>
            <if test="submitDate != null">
                submit_date = #{submitDate,jdbcType=TIMESTAMP},
            </if>
            <if test="proStatus != null">
                pro_status = #{proStatus,jdbcType=VARCHAR},
            </if>
            <if test="proStatusName != null">
                pro_status_name = #{proStatusName,jdbcType=VARCHAR},
            </if>
            <if test="processId != null">
                process_id = #{processId,jdbcType=BIGINT},
            </if>
            <if test="statisticsPrincipal != null">
                statistics_principal = #{statisticsPrincipal,jdbcType=VARCHAR},
            </if>
            <if test="unitPrincipal != null">
                unit_principal = #{unitPrincipal,jdbcType=VARCHAR},
            </if>
            <if test="headHtml != null">
                head_html = #{headHtml,jdbcType=VARCHAR},
            </if>
            <if test="bodyHtml != null">
                body_html = #{bodyHtml,jdbcType=VARCHAR},
            </if>
            <if test="tailHtml != null">
                tail_html = #{tailHtml,jdbcType=VARCHAR},
            </if>
            <if test="orgCode != null">
                org_code = #{orgCode,jdbcType=VARCHAR},
            </if>
            <if test="expireDate != null">
                expire_date = #{expireDate,jdbcType=TIMESTAMP},
            </if>
            <if test="auditId != null">
                audit_id = #{auditId,jdbcType=VARCHAR},
            </if>
            <if test="enterpriseName != null">
                enterprise_name = #{enterpriseName,jdbcType=VARCHAR},
            </if>
            <if test="dataFrom != null">
                data_from = #{dataFrom,jdbcType=VARCHAR},
            </if>
            <if test="enterprise != null">
                enterprise = #{enterprise,jdbcType=VARCHAR},
            </if>
            <if test="gmtCreate != null">
                gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
            </if>
            <if test="gmtModified != null">
                gmt_modified = #{gmtModified,jdbcType=TIMESTAMP},
            </if>
            <if test="reportDate != null">
                report_date = #{reportDate,jdbcType=TIMESTAMP},
            </if>
            <if test="fillDate != null">
                fill_date = #{fillDate,jdbcType=TIMESTAMP},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.hyjj.hyjjservice.dataobject.ReportData">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sat Jan 09 22:49:25 CST 2021.
        -->
        update report_data
        set fill_person = #{fillPerson,jdbcType=VARCHAR},
        fill_unit = #{fillUnit,jdbcType=VARCHAR},
        add_date = #{addDate,jdbcType=TIMESTAMP},
        area_name = #{areaName,jdbcType=VARCHAR},
        report_template_id = #{reportTemplateId,jdbcType=BIGINT},
        area_code = #{areaCode,jdbcType=VARCHAR},
        begin_date = #{beginDate,jdbcType=TIMESTAMP},
        end_date = #{endDate,jdbcType=TIMESTAMP},
        submit_date = #{submitDate,jdbcType=TIMESTAMP},
        pro_status = #{proStatus,jdbcType=VARCHAR},
        pro_status_name = #{proStatusName,jdbcType=VARCHAR},
        process_id = #{processId,jdbcType=BIGINT},
        statistics_principal = #{statisticsPrincipal,jdbcType=VARCHAR},
        unit_principal = #{unitPrincipal,jdbcType=VARCHAR},
        head_html = #{headHtml,jdbcType=VARCHAR},
        body_html = #{bodyHtml,jdbcType=VARCHAR},
        tail_html = #{tailHtml,jdbcType=VARCHAR},
        org_code = #{orgCode,jdbcType=VARCHAR},
        expire_date = #{expireDate,jdbcType=TIMESTAMP},
        audit_id = #{auditId,jdbcType=VARCHAR},
        enterprise_name = #{enterpriseName,jdbcType=VARCHAR},
        data_from = #{dataFrom,jdbcType=VARCHAR},
        enterprise = #{enterprise,jdbcType=VARCHAR},
        gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
        gmt_modified = #{gmtModified,jdbcType=TIMESTAMP},
        report_date = #{reportDate,jdbcType=TIMESTAMP},
        fill_date = #{fillDate,jdbcType=TIMESTAMP}
        where id = #{id,jdbcType=BIGINT}
    </update>

    <select id="selectReportDataByIndustryId" resultType="com.hyjj.hyjjservice.controller.report.viewobject.AuditReportVO">
        SELECT
        rd.`id`,rd.`fill_person`,rd.`fill_unit`,rd.`report_template_id`,rd.`begin_date`,
        rd.`submit_date`,rd.`pro_status`,
        rd.`enterprise_name`,rd.`report_date`,rd.`number`,rd.`title`,i.`name`
        FROM report_data rd
        INNER JOIN report_template rt
        ON rd.`report_template_id` = rt.`id`
        INNER JOIN industry i
        ON rt.`type` = i.`id`
        <where>
            rt.type IN
            <foreach collection="industriesIds" item="industriesId" open="(" close=")" separator=",">
                #{industriesId}
            </foreach>
            and rt.`rep_class` = #{type}
            and rd.`submit_date` between #{year} and #{nextYear}
            <if test="statue != null">
                and rd.`pro_status` = #{statue}
            </if>
        </where>
    </select>

    <select id="selectAllIndustryReportData" resultType="com.hyjj.hyjjservice.controller.report.viewobject.AuditReportVO">
        SELECT
        rd.`id`,rd.`fill_person`,rd.`fill_unit`,rd.`report_template_id`,rd.`begin_date`,
        rd.`submit_date`,rd.`pro_status`,
        rd.`enterprise_name`,rd.`report_date`,rd.`number`,rd.`title`,i.`name`
        FROM report_data rd
        INNER JOIN report_template rt
        ON rd.`report_template_id` = rt.`id`
        INNER JOIN industry i
        ON rt.`type` = i.`id`
        <where>
            and rt.`rep_class` = #{type}
            and rd.`submit_date` between #{year} and #{nextYear}
            <if test="statue != null">
                and rd.`pro_status` = #{statue}
            </if>
        </where>
    </select>

    <update id="updateProcessByReportId">
        update report_data
        set
        pro_status = #{proStatus,jdbcType=VARCHAR},
        pro_status_name = #{proStatusName,jdbcType=VARCHAR},
        process_id = #{processId,jdbcType=BIGINT}
        where id = #{reportId}
    </update>

    <select id="getReportDataListByUserId" resultType="com.hyjj.hyjjservice.controller.fill.viewObject.ReportDataList">
        select id,`number`,title,report_date,fill_unit,submit_date,pro_status_name from report_data where user_id = #{userId} and pro_status = "填报数据"
    </select>

    <select id="getReportDataHtml" resultType="com.hyjj.hyjjservice.controller.fill.viewObject.ReportDataHtml">
        select id,head_html,body_html,tail_html from report_data where id = #{id} and user_id = #{userId}
    </select>

    <update id="saveReportDataHtml" parameterType="com.hyjj.hyjjservice.controller.fill.viewObject.ReportDataHtml">
        update report_data set head_html = #{headHtml},body_html = #{bodyHtml},tail_html = #{tailHtml} where id = #{id}
    </update>

    <update id="submitReportData" parameterType="com.hyjj.hyjjservice.controller.fill.viewObject.ReportDataHtml">
        update report_data set head_html = #{headHtml},body_html = #{bodyHtml},tail_html = #{tailHtml},pro_status_name = "审核数据",pro_status = "审核" where id = #{id}
    </update>

    <update id="clearReportDataByReportId">
        update report_data rd join report_template rt on rd.report_template_id = rt.`id` set rd.body_html = rt.body_html where rd.id = #{reportId}
    </update>

    <select id="getStatement" resultMap="BaseResultMap">
        SELECT
        rd.`id`,rd.`fill_person`,rd.`fill_unit`,rd.`add_date`,rd.`area_name`,rd.`report_template_id`,rd.`area_code`,rd.`begin_date`,
        rd.`end_date`,rd.`submit_date`,rd.`pro_status`,rd.`pro_status_name`,rd.`process_id`,rd.`statistics_principal`,
        rd.`unit_principal`,rd.`org_code`,rd.`expire_date`,rd.`audit_id`,rd.`enterprise_name`,rd.`data_from`,
        rd.`enterprise`,rd.`report_date`,rd.`fill_date`,rd.`number`,rd.`title`
        FROM report_data rd
        inner join process on rd.`process_id` = process.`id`
        <where>
            1 = 1
            <if test="week != null">
                and week(process.`update_time`) = #{week}
            </if>
            <if test="month != null">
                and MONTH(process.`update_time`) = #{month}
            </if>
            <if test="audit != null">
                and rd.`pro_status` like #{audit}
            </if>
            <if test="userId != null">
                and rd.`user_id` = #{userId}
            </if>
        </where>
    </select>

    <select id="getRowAndColByTemplateId" resultType="com.hyjj.hyjjservice.dataobject.ReportTemplate">
        select `row`,col from report_template rt join report_data rd on rt.id = rd.report_template_id where rd.id = #{reportId}
    </select>

    <select id="selectByYearAndCompany" resultType="com.hyjj.hyjjservice.controller.report.viewobject.UrgeReportVO">
        SELECT rd.`id`, rd.`fill_person`, rd.`fill_unit`, rd.`begin_date`, rd.`end_date`, rd.`number`
        FROM report_data rd
        <where>
            YEAR(rd.`begin_date`) = #{year}
            AND rd.`pro_status` = '填报数据'
            <if test="company != null">
                and rd.`fill_unit` = #{company}
            </if>
        </where>
    </select>
    <select id="reportSelectAllIndustryReportData" resultType="com.hyjj.hyjjservice.controller.fill.viewObject.ReportDataList">
        SELECT
        rd.id,rd.`number`,rd.title,rd.report_date,rd.fill_unit,rd.submit_date,rd.pro_status_name,i.name
        FROM report_data rd
        INNER JOIN report_template rt
        ON rd.`report_template_id` = rt.`id`
        INNER JOIN industry i
        ON rt.`type` = i.`id`
        <where>
            and rt.`rep_class` = #{type}
            and rd.`submit_date` between #{year} and #{nextYear}
            and rd.`user_id` = #{userId}
            <if test="statue != null">
                and rd.`pro_status` = #{statue}
            </if>
        </where>
    </select>

    <select id="reportSelectReportDataByIndustryId" resultType="com.hyjj.hyjjservice.controller.fill.viewObject.ReportDataList">
        SELECT
        rd.id,rd.`number`,rd.title,rd.report_date,rd.fill_unit,rd.submit_date,rd.pro_status_name,i.name
        FROM report_data rd
        INNER JOIN report_template rt
        ON rd.`report_template_id` = rt.`id`
        INNER JOIN industry i
        ON rt.`type` = i.`id`
        <where>
            rt.type IN
            <foreach collection="industriesIds" item="industriesId" open="(" close=")" separator=",">
                #{industriesId}
            </foreach>
            and rt.`rep_class` = #{type}
            and rd.`submit_date` between #{year} and #{nextYear}
            and rd.`user_id` = #{userId}
            <if test="statue != null">
                and rd.`pro_status` = #{statue}
            </if>
        </where>
    </select>
</mapper>