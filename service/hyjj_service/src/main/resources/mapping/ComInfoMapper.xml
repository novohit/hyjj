<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hyjj.hyjjservice.dao.ComInfoMapper">
  <resultMap id="BaseResultMap" type="com.hyjj.hyjjservice.dataobject.ComInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 29 16:21:52 CST 2020.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="com_code" jdbcType="VARCHAR" property="comCode" />
    <result column="com_name" jdbcType="VARCHAR" property="comName" />
    <result column="com_comtype" jdbcType="VARCHAR" property="comComtype" />
    <result column="com_orgtype" jdbcType="VARCHAR" property="comOrgtype" />
    <result column="com_industrycode" jdbcType="VARCHAR" property="comIndustrycode" />
    <result column="com_regtype" jdbcType="VARCHAR" property="comRegtype" />
    <result column="com_businessstatus" jdbcType="VARCHAR" property="comBusinessstatus" />
    <result column="com_address_county" jdbcType="VARCHAR" property="comAddressCounty" />
    <result column="gmt_create" jdbcType="TIMESTAMP" property="gmtCreate" />
    <result column="gmt_modified" jdbcType="TIMESTAMP" property="gmtModified" />
    <association property="industry" columnPrefix="ind_" column="industry_id" javaType="com.hyjj.hyjjservice.dataobject.Industry" resultMap="com.hyjj.hyjjservice.dao.IndustryMapper.BaseResultMap"/>
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 29 16:21:52 CST 2020.
    -->
    id, com_code, com_name, com_comtype, com_orgtype, com_industrycode, com_regtype, 
    com_businessstatus, com_address_county, industry_id, gmt_create, gmt_modified
  </sql>
  <sql id="selectColumns">
    cominfo.id as id, com_code, com_name, com_comtype, com_orgtype, com_industrycode, com_regtype,
    com_businessstatus, com_address_county
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 29 16:21:52 CST 2020.
    -->
    select 
    <include refid="Base_Column_List" />
    from cominfo
    where id = #{id,jdbcType=BIGINT}
  </select>
  <select id="selectByIndustryEtc" parameterType="com.hyjj.hyjjservice.dao.param.ComInfoQueryPo" resultMap="BaseResultMap">
      select
      <include refid="selectColumns"></include>
      ,`name` as ind_name
      from cominfo inner join industry
      on cominfo.industry_id = industry.id
      <where>
          <if test="comTypes != null">
              com_comtype in
              <foreach collection="comTypes" open="(" close=")" separator=", " item="comType">
                  #{comType}
              </foreach>
          </if>
          <if test="industryIds != null">
              and industry_id in
              <foreach collection="industryIds" open="(" close=")" separator=", " item="id">
                  #{id}
              </foreach>
          </if>
          <if test="county != null">
              and com_address_county = #{county}
          </if>
          <if test="name != null">
              and com_name like CONCAT('%', #{name}, '%')
          </if>
      </where>
      limit #{start}, #{size}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 29 16:21:52 CST 2020.
    -->
    delete from cominfo
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.hyjj.hyjjservice.dataobject.ComInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 29 16:21:52 CST 2020.
    -->
    insert into cominfo (id, com_code, com_name, 
      com_comtype, com_orgtype, com_industrycode, 
      com_regtype, com_businessstatus, com_address_county, 
      industry_id, gmt_create, gmt_modified
      )
    values (#{id,jdbcType=BIGINT}, #{comCode,jdbcType=VARCHAR}, #{comName,jdbcType=VARCHAR},
      #{comComtype,jdbcType=VARCHAR}, #{comOrgtype,jdbcType=VARCHAR}, #{comIndustrycode,jdbcType=VARCHAR},
      #{comRegtype,jdbcType=VARCHAR}, #{comBusinessstatus,jdbcType=VARCHAR}, #{comAddressCounty,jdbcType=VARCHAR},
      #{industryId,jdbcType=INTEGER}, #{gmtCreate,jdbcType=TIMESTAMP}, #{gmtModified,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.hyjj.hyjjservice.dataobject.ComInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 29 16:21:52 CST 2020.
    -->
    insert into cominfo
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="comCode != null">
        com_code,
      </if>
      <if test="comName != null">
        com_name,
      </if>
      <if test="comComtype != null">
        com_comtype,
      </if>
      <if test="comOrgtype != null">
        com_orgtype,
      </if>
      <if test="comIndustrycode != null">
        com_industrycode,
      </if>
      <if test="comRegtype != null">
        com_regtype,
      </if>
      <if test="comBusinessstatus != null">
        com_businessstatus,
      </if>
      <if test="comAddressCounty != null">
        com_address_county,
      </if>
      <if test="industryId != null">
        industry_id,
      </if>
      <if test="gmtCreate != null">
        gmt_create,
      </if>
      <if test="gmtModified != null">
        gmt_modified,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=BIGINT},
      </if>
      <if test="comCode != null">
        #{comCode,jdbcType=VARCHAR},
      </if>
      <if test="comName != null">
        #{comName,jdbcType=VARCHAR},
      </if>
      <if test="comComtype != null">
        #{comComtype,jdbcType=VARCHAR},
      </if>
      <if test="comOrgtype != null">
        #{comOrgtype,jdbcType=VARCHAR},
      </if>
      <if test="comIndustrycode != null">
        #{comIndustrycode,jdbcType=VARCHAR},
      </if>
      <if test="comRegtype != null">
        #{comRegtype,jdbcType=VARCHAR},
      </if>
      <if test="comBusinessstatus != null">
        #{comBusinessstatus,jdbcType=VARCHAR},
      </if>
      <if test="comAddressCounty != null">
        #{comAddressCounty,jdbcType=VARCHAR},
      </if>
      <if test="industryId != null">
        #{industryId,jdbcType=INTEGER},
      </if>
      <if test="gmtCreate != null">
        #{gmtCreate,jdbcType=TIMESTAMP},
      </if>
      <if test="gmtModified != null">
        #{gmtModified,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.hyjj.hyjjservice.dataobject.ComInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 29 16:21:52 CST 2020.
    -->
    update cominfo
    <set>
      <if test="comCode != null">
        com_code = #{comCode,jdbcType=VARCHAR},
      </if>
      <if test="comName != null">
        com_name = #{comName,jdbcType=VARCHAR},
      </if>
      <if test="comComtype != null">
        com_comtype = #{comComtype,jdbcType=VARCHAR},
      </if>
      <if test="comOrgtype != null">
        com_orgtype = #{comOrgtype,jdbcType=VARCHAR},
      </if>
      <if test="comIndustrycode != null">
        com_industrycode = #{comIndustrycode,jdbcType=VARCHAR},
      </if>
      <if test="comRegtype != null">
        com_regtype = #{comRegtype,jdbcType=VARCHAR},
      </if>
      <if test="comBusinessstatus != null">
        com_businessstatus = #{comBusinessstatus,jdbcType=VARCHAR},
      </if>
      <if test="comAddressCounty != null">
        com_address_county = #{comAddressCounty,jdbcType=VARCHAR},
      </if>
      <if test="industryId != null">
        industry_id = #{industryId,jdbcType=INTEGER},
      </if>
      <if test="gmtCreate != null">
        gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
      </if>
      <if test="gmtModified != null">
        gmt_modified = #{gmtModified,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.hyjj.hyjjservice.dataobject.ComInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 29 16:21:52 CST 2020.
    -->
    update cominfo
    set com_code = #{comCode,jdbcType=VARCHAR},
      com_name = #{comName,jdbcType=VARCHAR},
      com_comtype = #{comComtype,jdbcType=VARCHAR},
      com_orgtype = #{comOrgtype,jdbcType=VARCHAR},
      com_industrycode = #{comIndustrycode,jdbcType=VARCHAR},
      com_regtype = #{comRegtype,jdbcType=VARCHAR},
      com_businessstatus = #{comBusinessstatus,jdbcType=VARCHAR},
      com_address_county = #{comAddressCounty,jdbcType=VARCHAR},
      industry_id = #{industryId,jdbcType=INTEGER},
      gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
      gmt_modified = #{gmtModified,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=BIGINT}
  </update>


  <resultMap id="CompanyAnalyseDataByRegion" type="com.hyjj.hyjjservice.service.company.model.CompanyAnalyseModel">
    <result column="com_address_county" jdbcType="VARCHAR" property="dataName" />
    <result column="num" jdbcType="INTEGER" property="dataNum"/>
  </resultMap>

  <select id="countByRegion" resultMap="CompanyAnalyseDataByRegion">
        select
            com_address_county , count(*) num
         from cominfo
         group by  com_address_county
  </select>


  <resultMap id="CompanyAnalyseDataByIndustry" type="com.hyjj.hyjjservice.service.company.model.CompanyAnalyseModel">
    <result column="name" jdbcType="VARCHAR" property="dataName" />
    <result column="num" jdbcType="INTEGER" property="dataNum"/>
  </resultMap>

  <select id="countByIndustry" resultMap="CompanyAnalyseDataByIndustry">
        select
            i.name name, count(*) num
         from cominfo c join industry i on c.industry_id = i.id
         group by  industry_id
  </select>


  <resultMap id="CompanyAnalyseDataByComType" type="com.hyjj.hyjjservice.service.company.model.CompanyAnalyseModel">
    <result column="com_comtype" jdbcType="VARCHAR" property="dataName" />
    <result column="num" jdbcType="INTEGER" property="dataNum"/>
  </resultMap>

  <select id="countByByComType" resultMap="CompanyAnalyseDataByComType">
        select
            com_comtype , count(*) num
         from cominfo
         group by  com_comtype
  </select>

  <select id="selectCountCompany" parameterType="com.hyjj.hyjjservice.dao.param.ComInfoQueryPo"  resultType="java.lang.Long">
    select
    count(*)
    from cominfo inner join industry
    on cominfo.industry_id = industry.id
    <where>
      <if test="comTypes != null">
        com_comtype in
        <foreach collection="comTypes" open="(" close=")" separator=", " item="comType">
          #{comType}
        </foreach>
      </if>
      <if test="industryIds != null">
        and industry_id in
        <foreach collection="industryIds" open="(" close=")" separator=", " item="id">
          #{id}
        </foreach>
      </if>
      <if test="county != null">
        and com_address_county = #{county}
      </if>
      <if test="name != null">
        and com_name like CONCAT('%', #{name}, '%')
      </if>
    </where>
  </select>

  <select id="selectAllCompany" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from cominfo
  </select>

  <select id="selectCompanyNameByUserId" resultType="java.lang.String">
    SELECT
        com_name
    FROM cominfo
    INNER JOIN
    user
    ON user.`cominfo_id` = cominfo.`id`
    WHERE user.`id` = #{userId};
  </select>
  <select id="getCompanyNameList" resultMap="BaseResultMap">
    select id, com_name from cominfo
    <if test="name != null">
      where com_name like concat('%',#{name},'%')
    </if>
  </select>
  <select id="getCompanyNameListSum" resultType="java.lang.Integer">
    select count(*) from cominfo
    <if test="name != null">
      where com_name like concat('%',#{name},'%')
    </if>
  </select>
  <select id="getNotUsedCompanyList" resultMap="BaseResultMap">
    select cominfo.id, cominfo.com_name from cominfo

    where (select count(*) from user_role where id = cominfo.id) = 0
  </select>

  <select id="getTableHeadInfo" resultType="com.hyjj.hyjjservice.controller.fill.viewObject.TableHeadInfo">
    select com_code "OrganizationCode",com_name "UnitName",com_address_county "AreaName" from (cominfo inner join `user` on user.cominfo_id = cominfo.id)inner join report_data  on report_data.user_id = user.id where report_data.id = #{reportId} and report_data.is_save = 0;
  </select>

  <select id="selectComInfoIds" resultType="java.lang.Long">
    select cominfo.id from cominfo inner join `user` on user.cominfo_id = cominfo.id where user.statue = "正常"
  </select>

  <select id="getCompanyList" resultType="com.hyjj.hyjjservice.controller.company.viewObject.CompanyInfo">
    SELECT c.id, c.com_name, i.`name` FROM cominfo c LEFT JOIN industry i ON c.`industry_id` = i.`id` where c.id = #{id};
  </select>
</mapper>